<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supermarket Products</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }

    h1 {
      margin-top: 0;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    .delete-button {
      background-color: #ff4d4d;
      border: none;
      color: #fff;
      padding: 6px 12px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      cursor: pointer;
    }

    .login-form,
    .register-form {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }

    .form-group label {
      margin-bottom: 5px;
    }

    .form-group input {
      padding: 5px;
    }

    .form-group button {
      margin-top: 10px;
      padding: 8px 16px;
    }

    .message {
      margin-top: 10px;
      color: red;
    }
  </style>
</head>
<body>
  <h1>Supermarket Products</h1>

  <div id="loginContainer">
    <h2>Login</h2>
    <form id="loginForm" class="login-form">
      <div class="form-group">
        <label for="loginUsername">Username:</label>
        <input type="text" id="loginUsername" required>
      </div>

      <div class="form-group">
        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" required>
      </div>

      <button type="submit">Login</button>
      <p class="message" id="loginMessage"></p>
    </form>
  </div>

  <div id="registerContainer">
    <h2>Register</h2>
    <form id="registerForm" class="register-form">
      <div class="form-group">
        <label for="registerUsername">Username:</label>
        <input type="text" id="registerUsername" required>
      </div>

      <div class="form-group">
        <label for="registerPassword">Password:</label>
        <input type="password" id="registerPassword" required>
      </div>

      <button type="submit">Register</button>
      <p class="message" id="registerMessage"></p>
    </form>
  </div>

  <form id="addForm">
    <label for="name">Product Name:</label>
    <input type="text" id="name" name="name" required>

    <label for="price">Price:</label>
    <input type="number" id="price" name="price" step="0.01" required>

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" name="quantity" required>

    <button type="submit">Add Product</button>
  </form>

  <table id="productTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const apiUrl = 'http://localhost:3000'; // Replace with your API URL

      // Function to fetch and display products
      function fetchProducts(token) {
        console.log('Fetching products...');

        fetch(`${apiUrl}/products`, {
          headers: {
            'Authorization': `Bearer ${token}` // Include the token in the request headers
          }
        })
        .then(response => response.json())
        .then(products => {
          console.log('Products:', products);
          const tableBody = document.querySelector('#productTable tbody');
          tableBody.innerHTML = '';

          products.forEach(product => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${product.name}</td>
              <td>${product.price}</td>
              <td>${product.quantity}</td>
              <td>
                <button class="delete-button" onclick="deleteProduct(${product.id})">Delete</button>
                <button onclick="editProduct(${product.id}, '${product.name}', ${product.price}, ${product.quantity})">Edit</button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        })
        .catch(error => {
          console.error('Error:', error);
        });
      }

      function deleteProduct(productId) {
        fetch(`${apiUrl}/products/${productId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          }
        })
        .then(response => response.json())
        .then(data => {
          console.log(data.message);
          fetchProducts(localStorage.getItem('token'));
        })
        .catch(error => {
          console.error('Error:', error);
        });
      }

      // Function to edit a product
      function editProduct(productId, productName, productPrice, productQuantity) {
        const name = prompt('Enter new name:', productName);
        const price = parseFloat(prompt('Enter new price:', productPrice));
        const quantity = parseInt(prompt('Enter new quantity:', productQuantity));

        if (name && price && quantity) {
          const updatedProduct = {
            name,
            price,
            quantity
        };

        fetch(`${apiUrl}/products/${productId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          },
          body: JSON.stringify(updatedProduct)
        })
          .then(response => response.json())
          .then(data => {
            console.log(data.message);
            fetchProducts(localStorage.getItem('token'));
          })
          .catch(error => {
            console.error('Error:', error);
          });
        }
      }

      // Function to add a product
      function addProduct(event) {
        event.preventDefault();

        const name = document.querySelector('#name').value;
        const price = parseFloat(document.querySelector('#price').value);
        const quantity = parseInt(document.querySelector('#quantity').value);

        if (name && price && quantity) {
          const newProduct = {
            name,
            price,
            quantity
          };

          fetch(`${apiUrl}/products`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify(newProduct)
          })
            .then(response => response.json())
            .then(data => {
              console.log(data.message);
              fetchProducts(localStorage.getItem('token'));
              document.querySelector('#addForm').reset();
            })
            .catch(error => {
              console.error('Error:', error);
            });
        }
      }

      // Function to handle login
      function handleLogin(event) {
        event.preventDefault();

        const username = document.querySelector('#loginUsername').value;
        const password = document.querySelector('#loginPassword').value;

        if (username && password) {
          const user = {
            username,
            password
          };

          fetch(`${apiUrl}/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(user)
          })
            .then(response => response.json())
            .then(data => {
              const { token } = data;

              if (token) {
                localStorage.setItem('token', token);
                document.querySelector('#loginForm').reset();
                document.querySelector('#loginMessage').textContent = '';
                showApp();
              } else {
                document.querySelector('#loginMessage').textContent = 'Invalid username or password.';
              }
            })
            .catch(error => {
              console.error('Error:', error);
            });
        }
      }

      // Function to handle registration
      function handleRegister(event) {
        event.preventDefault();

        const username = document.querySelector('#registerUsername').value;
        const password = document.querySelector('#registerPassword').value;

        if (username && password) {
          const user = {
            username,
            password
          };

          fetch(`${apiUrl}/register`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(user)
          })
            .then(response => response.json())
            .then(data => {
              console.log(data.message);
              document.querySelector('#registerForm').reset();
              document.querySelector('#registerMessage').textContent = '';
            })
            .catch(error => {
              console.error('Error:', error);
            });
        }
      }

      // Function to show/hide app based on token presence
      function showApp() {
        const token = localStorage.getItem('token');
        const loginContainer = document.querySelector('#loginContainer');
        const registerContainer = document.querySelector('#registerContainer');
        const productTable = document.querySelector('#productTable');
        const addForm = document.querySelector('#addForm');

        if (token) {
          loginContainer.style.display = 'none';
          registerContainer.style.display = 'none';
          productTable.style.display = 'table';
          addForm.style.display = 'block';
          fetchProducts(token);
        } else {
          loginContainer.style.display = 'block';
          registerContainer.style.display = 'block';
          productTable.style.display = 'none';
          addForm.style.display = 'none';
        }
      }

      // Check if the user is already logged in
      showApp();

      // Event listeners
      document.querySelector('#addForm').addEventListener('submit', addProduct);
      document.querySelector('#loginForm').addEventListener('submit', handleLogin);
      document.querySelector('#registerForm').addEventListener('submit', handleRegister);
    });
  </script>
</body>
</html>
